---
phase: 05-ui-contract-alignment
plan: 04
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - ui_service/src/app/pipeline/page.tsx
  - ui_service/src/components/pipeline/BuildJobPanel.tsx
  - ui_service/src/components/pipeline/ValidationReport.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "/pipeline page renders build job list with attempt timelines from real SSE data"
    - "Validation report displays check results from artifact store"
    - "SSE connection indicator shows live/disconnected state"
    - "Build flow visualization uses React Flow (already in dependencies)"
  artifacts:
    - path: "ui_service/src/app/pipeline/page.tsx"
      provides: "Rewritten pipeline page with job list + detail panels"
      min_lines: 100
    - path: "ui_service/src/components/pipeline/BuildJobPanel.tsx"
      provides: "Build job detail with attempt timeline"
      min_lines: 60
    - path: "ui_service/src/components/pipeline/ValidationReport.tsx"
      provides: "Validation check results table"
      min_lines: 40
  key_links:
    - from: "ui_service/src/app/pipeline/page.tsx"
      to: "ui_service/src/store/nexusStore.ts"
      via: "uses SSE pipeline state"
      pattern: "useNexusStore"
    - from: "ui_service/src/app/pipeline/page.tsx"
      to: "ui_service/src/components/pipeline/BuildJobPanel.tsx"
      via: "renders selected job detail"
      pattern: "BuildJobPanel"
    - from: "ui_service/src/components/pipeline/BuildJobPanel.tsx"
      to: "ui_service/src/lib/adminClient.ts"
      via: "fetches build job details and validation reports"
      pattern: "adminApi\\."
---

<objective>
Rewrite the pipeline viewer page as a capability-driven build job dashboard with validation reports.

Purpose: The current pipeline page (183 lines) shows basic React Flow visualization. This plan adds build job management with attempt timelines, validation report display, and SSE connection status — turning it into a real self-evolution monitoring tool.

Output: Enhanced /pipeline page with job list, attempt timeline, validation report, and React Flow flow visualization.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-contract-alignment/05-01-SUMMARY.md

@ui_service/src/app/pipeline/page.tsx
@ui_service/src/components/pipeline/ServiceNode.tsx
@ui_service/src/components/pipeline/ModuleNode.tsx
@ui_service/src/components/pipeline/StageNode.tsx
@ui_service/src/store/nexusStore.ts
@ui_service/src/lib/adminClient.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pipeline page rewrite with build job management</name>
  <files>
    ui_service/src/app/pipeline/page.tsx
    ui_service/src/components/pipeline/BuildJobPanel.tsx
    ui_service/src/components/pipeline/ValidationReport.tsx
  </files>
  <action>
    **Generate visual shell with v0:**
    ```
    "Next.js page with shadcn/ui. Three-panel layout. Left panel: scrollable job list showing module build jobs, each with job name, status badge (queued/building/validating/repairing/complete/failed), attempt count (e.g. '3/10 attempts'), and timestamp. Center panel: selected job's attempt timeline as a vertical stepper — each step shows stage name (scaffold/implement/test/repair/install), duration, pass/fail icon, and an expandable log excerpt area. Bottom panel: validation report as a table with columns (check_name, status icon, details/message). Top-right corner: SSE connection indicator badge (green dot = connected, red dot = disconnected). Dark mode. Tailwind."
    ```

    **Wire with Cursor:**
    
    Left Panel (Job List):
    - Use existing `useNexusStore` for SSE pipeline state (already connected)
    - Extend `adminClient.ts` with `getBuildJobs()` method — calls existing module builder endpoints or uses pipeline SSE data
    - Job status badges: queued=gray, building=blue, validating=yellow, repairing=orange, complete=green, failed=red
    - Attempt count display: "3/10" format (current/max from MAX_REPAIR_ATTEMPTS)
    - Clicking a job selects it and populates center panel

    Center Panel (BuildJobPanel component):
    - Create `ui_service/src/components/pipeline/BuildJobPanel.tsx`
    - Vertical stepper for attempt timeline:
      - Stages: scaffold → implement → tests → repair → install (from Phase 3 Plan 04 stage pipeline)
      - Each step: stage name, duration (formatted), pass/fail icon, expandable log
    - Duration formatting: "1.2s", "45s", "2m 15s"
    - Expandable log excerpt: show first 5 lines, "Show more" expands to full log
    - If no job selected: show `EmptyState` with "Select a build job to view details"

    Bottom Panel (ValidationReport component):
    - Create `ui_service/src/components/pipeline/ValidationReport.tsx`
    - Table columns: check_name, status (✓/✗ icon), details
    - Wire to validation report from artifact store (extend adminClient if endpoint exists, otherwise show placeholder message)
    - Status icons: pass=green check, fail=red X, warn=yellow triangle

    SSE Connection Indicator:
    - Use `useNexusStore().connected` state (already exists)
    - Green dot + "Connected" when SSE is active
    - Red dot + "Disconnected" when SSE is down
    - Clicking reconnects (calls `startSSE()`)

    React Flow visualization:
    - Keep existing React Flow nodes (ServiceNode, ModuleNode, StageNode) for the build→validate→repair→install flow
    - Add flow as a toggleable overlay or additional tab ("Flow View" / "List View")

    **Preserve existing pipeline components**: Do NOT delete ServiceNode.tsx, ModuleNode.tsx, StageNode.tsx — they're used in the React Flow visualization.

    **Tool usage note**: Use **v0** for the three-panel layout + stepper + table visuals. Use **Cursor** to wire SSE state from nexusStore, build job data from adminClient, and integrate with existing pipeline components.
  </action>
  <verify>
    npx tsc --noEmit --project ui_service/tsconfig.json 2>&1 | head -20
    curl -s http://localhost:3000/pipeline | head -5
    grep -c "BuildJobPanel" ui_service/src/app/pipeline/page.tsx  # should be >= 1
    grep -c "ValidationReport" ui_service/src/app/pipeline/page.tsx  # should be >= 1
  </verify>
  <done>
    /pipeline page renders three panels: job list, attempt timeline, validation report.
    SSE connection indicator shows real-time connection state.
    Build job selection populates detail panel with attempt timeline.
    Validation report shows check results in table format.
    React Flow visualization preserved as toggleable view.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- /pipeline page loads with three-panel layout
- SSE indicator shows connection state (green/red)
- Existing React Flow visualization still works
- BuildJobPanel renders empty state when no job selected
- ValidationReport renders table headers (even if no data)
</verification>

<success_criteria>
- Pipeline page is a real build monitoring tool, not just a React Flow diagram
- Build job state comes from live data (SSE + admin API), not hardcoded
- Self-evolution pipeline stages are visible with attempt tracking
- SSE reconnection works when indicator is clicked
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-contract-alignment/05-04-SUMMARY.md`
</output>
