# Prometheus Configuration
# Scrapes metrics from OpenTelemetry Collector, services, and cAdvisor

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'grpc-llm-monitor'

# Alerting configuration
alerting:
  alertmanagers: []

# Alert rule files
rule_files:
  - /etc/prometheus/rules/*.yml

# Scrape configurations
scrape_configs:
  # OpenTelemetry Collector metrics (all OTel-instrumented services export here)
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['otel-collector:8889']
    metrics_path: /metrics

  # Orchestrator metrics via OTel collector Prometheus exporter
  # OTel metrics (grpc_*, tool_*, llm_*, lidm_*, pipeline_*, nexus_*) are
  # exported through otel-collector:8889 above. The orchestrator exposes
  # its own Prometheus endpoint on port 8888 for direct scraping.
  - job_name: 'orchestrator'
    static_configs:
      - targets: ['orchestrator:8888']
    metrics_path: /metrics
    scrape_interval: 10s

  # Dashboard service metrics (prometheus_client direct)
  - job_name: 'dashboard-service'
    static_configs:
      - targets: ['dashboard_service:8001']
    metrics_path: /metrics
    scrape_interval: 15s

  # cAdvisor - Container resource usage (CPU, memory, network, disk)
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
    metrics_path: /metrics
    scrape_interval: 15s

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
