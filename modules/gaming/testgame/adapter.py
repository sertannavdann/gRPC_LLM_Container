"""
Testgame Adapter

Test game stats tracker

Auto-generated by NEXUS Executor Agent.
"""
import httpx
from datetime import datetime
from typing import Dict, Any, List

from shared.adapters.base import BaseAdapter, AdapterConfig
from shared.adapters.registry import register_adapter


API_BASE_URL = "https://api.testgame.com/v1"


@register_adapter(
    category="gaming",
    platform="testgame",
    display_name="Testgame",
    description="Test game stats tracker",
    icon="ðŸŽ®",
    requires_auth=True,
    auth_type="api_key",
)
class TestgameAdapter(BaseAdapter[Dict[str, Any]]):
    """
    Testgame adapter.
    Fetches data from https://api.testgame.com/v1 and transforms to canonical format.
    """

    category = "gaming"
    platform = "testgame"

    def __init__(self, config: AdapterConfig = None):
        super().__init__(config)
        self._api_base = API_BASE_URL
        self._timeout = httpx.Timeout(30.0)

    async def fetch_raw(self, config: AdapterConfig) -> Dict[str, Any]:
        """Fetch raw data from the Testgame API."""
        headers = {{}}
        if config and config.credentials:
            api_key = config.credentials.get("api_key", "")
            if api_key:
                headers["Authorization"] = f"Bearer {{api_key}}"

        async with httpx.AsyncClient(timeout=self._timeout) as client:
            response = await client.get(
                f"{{self._api_base}}/",
                headers=headers,
            )
            response.raise_for_status()
            return response.json()

    def transform(self, raw_data: Dict[str, Any]) -> List[Dict[str, Any]]:
        """Transform raw API response to canonical format."""
        items = raw_data.get("items", raw_data.get("data", []))
        if not isinstance(items, list):
            items = [items] if items else []

        results = []
        for item in items:
            results.append({{
                "id": str(item.get("id", "")),
                "name": str(item.get("name", "")),
                "data": item,
                "fetched_at": datetime.utcnow().isoformat(),
                "platform": self.platform,
            }})
        return results

    def get_capabilities(self) -> Dict[str, bool]:
        return {
            "read": True,
            "write": False,
            "real_time": False,
            "batch": True,
            "webhooks": False,
        }
